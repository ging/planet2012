<style type="text/css">  html, body {    width: 100%;  height: 100%; }  #map_canvas {   width: 100%;  height: 85%;  }</style><script src="http://maps.google.com/maps/api/js?sensor=false"> // Carga librería de Google Maps. Doc:  http://code.google.com/apis/maps/documentation/javascript/</script><script type="text/javascript">if (navigator.geolocation) {           navigator.geolocation.getCurrentPosition(displayPosition, errorFunction);  } else { alert('Geolocation is not supported in this browser.'); }// Success callback function  function displayPosition(pos){    var mylatMedia = 0;    var mylongMedia = 0;    var numSitios = <%= @trip.visits.size %> -1    var thediv = document.getElementById('locationinfo'); // Store my medium position (“y=mylatMedia”, “x=mylongMedia”) in variable “center”  var center = new google.maps.LatLng(mylatMedia/numSitios, mylongMedia/numSitios); // Define my Google Maps options in variable “myOptions”  var myOptions = {      zoom: 3,                                                                  // Define scale      center: center,                                                            // Define map center      mapTypeId: google.maps.MapTypeId.ROADMAP   // tipo Roadmad, Satellite, Terrain, Hybrid    };// Load Google Map according to “myOptions” in Canvas identified by “map_canvas”  var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions); // Add marker in Google Maps “map” in position defined by “lating”  <% @trip.visits.order(:hour).each do |s|%>    mylatMedia += <%= s.site.latitud %>;    mylongMedia += <%= s.site.longitud %>;    <% site = @trip.sites.find( s.site_id) %>    var mylat<%= site.id %> = <%= site.latitud %>;    var mylong<%= site.id %> = <%= site.longitud %>;    latlng<%= site.id %> = new google.maps.LatLng(mylat<%= site.id %>, mylong<%= site.id %>);    var image = new google.maps.MarkerImage(                                  "<%= image_path(site.image_url) %>",                                  new google.maps.Size(80,70),                                  new google.maps.Point(0,0),                                  new google.maps.Point(20,35),                                  new google.maps.Size(80,70)                        );   var marker<%= site.id %> = new google.maps.Marker({     position: latlng<%= site.id %>,      map: map,      icon: image,     draggable:false,     animation: google.maps.Animation.BOUNCE,     title: "<%= s.site.name %>"   }); <% end %>   }// Error callback function  function errorFunction(pos) { alert('Error!'); }</script><p>  <b>Name:</b>  <%= @trip.name %></p><p>  <b>Date:</b>  <%= @trip.date %></p><p>  <b>Autor:</b>   <%= @trip.user.name if @trip.user %></p> <p>  <b>Description:</b>  <%= simple_format @trip.description %></p><div id="site_list">  <h1>Sitios a visitar</h1> <div id="map_canvas" style="width:500px; height:350px; float:right; margin-rigth:50px;"></div> <div id="locationinfo"></div>  <%= render(@trip) %>  <% if @trip.user == current_user %>    <%= form_for(@visit) do |f| %>        <%= f.number_field :trip_id, :value => @trip.id, :hidden => true %>      <%= f.collection_select(:site_id,                             Site.all,                            :id,                             :name) %>      <%= f.select(:hour, Array.new(24, 0).fill {|i| [(i.to_s + 'H'), i]}) %>      <%= f.submit "Añadir sitio" %>    <% end %>  <% end %></div><br /><% if @trip.user == current_user %>   <%= link_to 'Edit', edit_trip_path(@trip) %> |<% end %><%= link_to 'Back', trips_path %>